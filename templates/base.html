{% load static %}
{% load pwa %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Igbo Archives - Preserving the Past, Inspiring the Future{% endblock %}</title>
    <link rel="icon" type="image/png" href="{% static 'images/logos/logo-light.png' %}">

    <a href="#main-content"
        class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-accent focus:text-white focus:px-4 focus:py-2 focus:rounded">Skip
        to main content</a>

    {% if ENABLE_ANALYTICS and GOOGLE_ANALYTICS_ID %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ GOOGLE_ANALYTICS_ID }}"></script>
    <script src="{% static 'js/common/analytics.js' %}" data-ga-id="{{ GOOGLE_ANALYTICS_ID }}"></script>
    {% endif %}

    {% progressive_web_app_meta %}

    {% if VAPID_PUBLIC_KEY %}
    <meta name="vapid-public-key" content="{{ VAPID_PUBLIC_KEY }}">
    {% endif %}

    <link rel="stylesheet" href="{% static 'vendor/css/swiper-bundle.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/tailwind.output.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/css/fontawesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}">
    <link rel="stylesheet" href="{% static 'css/modal.css' %}">
    <link rel="stylesheet" href="{% static 'css/comments.css' %}">
    <link rel="stylesheet" href="{% static 'css/share-buttons.css' %}">

    {% block extra_css %}{% endblock %}

    <meta name="description"
        content="{% block meta_description %}Igbo Archives - A platform for Igbo cultural preservation and community engagement{% endblock %}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:title"
        content="{% block og_title %}Igbo Archives - Preserving the Past, Inspiring the Future{% endblock %}">
    <meta property="og:description"
        content="{% block og_description %}Explore the rich cultural heritage of the Igbo people through our comprehensive digital archives, community insights, and educational resources.{% endblock %}">
    <meta property="og:image"
        content="{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'images/logos/logo-light.png' %}{% endblock %}">
    <meta property="og:image:width" content="{% block og_image_width %}1200{% endblock %}">
    <meta property="og:image:height" content="{% block og_image_height %}630{% endblock %}">

    <!-- Twitter -->
    <meta name="twitter:card" content="{% block twitter_card %}summary_large_image{% endblock %}">
    <meta name="twitter:url" content="{% block twitter_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta name="twitter:title"
        content="{% block twitter_title %}Igbo Archives - Preserving the Past, Inspiring the Future{% endblock %}">
    <meta name="twitter:description"
        content="{% block twitter_description %}Explore the rich cultural heritage of the Igbo people through our comprehensive digital archives, community insights, and educational resources.{% endblock %}">
    <meta name="twitter:image"
        content="{% block twitter_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'images/logos/logo-light.png' %}{% endblock %}">

    {% if ENABLE_ADSENSE %}
    <script async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client={{ GOOGLE_ADSENSE_CLIENT_ID }}"
        crossorigin="anonymous"></script>
    {% endif %}

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Igbo Archives",
      "url": "{{ request.scheme }}://{{ request.get_host }}",
      "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'images/logos/logo-light.png' %}",
      "sameAs": [
        "https://www.facebook.com/IgboArchives/",
        "https://www.instagram.com/IgboArchives.com.ng/",
        "https://x.com/IgboArchives",
        "https://mastodon.social/@Igbo_Archives"
      ],
      "description": "Preserving and celebrating the rich history and culture of the Igbo people."
    }
    </script>
</head>

<body class="font-sans antialiased bg-surface text-text min-h-screen flex flex-col">
    <!-- PWA Install Button -->
    <button
        class="fixed bottom-24 right-4 z-40 w-12 h-12 bg-accent text-white rounded-full shadow-lg hover:bg-accent-hover hover:scale-110 transition-all duration-300 hidden items-center justify-center md:bottom-6"
        id="pwaInstallBtn" aria-label="Install App">
        <i class="fas fa-download text-lg"></i>
    </button>

    <!-- Header -->
    <div class="sticky top-0 z-50 bg-white/95 dark:bg-surface-dark backdrop-blur-md shadow-sm border-b border-border dark:border-border-dark"
        id="stickyHeader">
        <header>
            <div class="max-w-7xl mx-auto flex items-center justify-between px-4 sm:px-6 lg:px-8 py-2.5 gap-3 relative">
                <!-- Left: Logo & Dark Mode -->
                <div class="flex items-center gap-4">
                    <a class="flex items-center" href="{% url 'core:home' %}">
                        <img src="{% static 'images/logos/logo-light.png' %}" alt="Igbo Archives"
                            class="h-8 lg:h-9 w-auto logo-light">
                        <img src="{% static 'images/logos/logo-dark.png' %}" alt="Igbo Archives"
                            class="h-8 lg:h-9 w-auto logo-dark hidden">
                    </a>

                    <button
                        class="btn-ghost w-9 h-9 p-0 rounded-lg hidden sm:flex items-center justify-center dark:text-text-dark"
                        aria-label="Toggle dark mode" id="darkModeToggle">
                        <i class="fas fa-moon text-sm"></i>
                    </button>
                </div>

                <!-- Right: Dark Mode & User Menu -->
                <div class="flex items-center gap-2 sm:gap-3">
                    <button class="btn-ghost w-9 h-9 p-0 rounded-lg sm:hidden" aria-label="Toggle dark mode"
                        id="darkModeToggleMobile">
                        <i class="fas fa-moon text-sm"></i>
                    </button>

                    {% if user.is_authenticated %}
                    <div class="relative dropdown" id="notificationDropdownContainer">
                        <button type="button" class="btn-ghost w-10 h-10 p-0 rounded-full relative"
                            id="notificationBell" aria-label="Notifications"
                            data-url="{% url 'api:notification_list' %}">
                            <i class="fas fa-bell text-lg"></i>
                            {% if unread_notification_count > 0 %}
                            <span id="notificationBadge"
                                class="absolute -top-0.5 -right-0.5 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center">{{unread_notification_count}}</span>
                            {% endif %}
                        </button>
                        <div class="dropdown-menu w-80 right-0" id="notificationDropdown">
                            <!-- Dropdown content will be loaded via JS -->
                        </div>
                    </div>

                    <div class="relative dropdown" id="profileDropdownContainer">
                        <button
                            class="flex items-center gap-2 px-3 py-2 rounded-full border-2 border-border hover:bg-accent hover:border-accent hover:text-white transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2"
                            id="profileButton">
                            {% if user.profile_picture %}
                            <div class="avatar avatar-sm">
                                <img src="{{ user.profile_picture.url }}" alt="{{ user.get_display_name }}">
                            </div>
                            {% else %}
                            <div class="avatar avatar-sm">
                                {{ user.get_display_name|slice:":1"|upper }}
                            </div>
                            {% endif %}
                            <span class="hidden sm:inline text-sm font-medium">{{ user.get_display_name }}</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>

                        <div class="dropdown-menu" id="profileDropdown">
                            <a href="{% url 'users:dashboard' %}" class="dropdown-item">
                                <i class="fas fa-th-large w-4 text-center"></i> Dashboard
                            </a>
                            <a href="{% url 'users:inbox' %}" class="dropdown-item">
                                <i class="fas fa-envelope w-4 text-center"></i> Messages
                            </a>
                            <a href="{% url 'users:profile' user.username %}" class="dropdown-item">
                                <i class="fas fa-user w-4 text-center"></i> My Profile
                            </a>
                            <a href="{% url 'users:profile_edit' user.username %}" class="dropdown-item">
                                <i class="fas fa-edit w-4 text-center"></i> Edit Profile
                            </a>
                            <div class="my-2 border-t border-border"></div>
                            <a href="{% url 'account_logout' %}" class="dropdown-item text-red-600 hover:bg-red-50"
                                id="logoutLink">
                                <i class="fas fa-sign-out-alt w-4 text-center"></i> Logout
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <a href="{% url 'account_login' %}" class="btn-primary btn-sm">
                        <i class="fas fa-sign-in-alt"></i>
                        <span class="hidden sm:inline">Login</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </header>

        <!-- Desktop Navigation -->
        <nav class="hidden lg:block border-t border-border bg-surface-alt/50" aria-label="Main navigation">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-center gap-1 py-2">
                    <a href="{% url 'archives:list' %}"
                        class="nav-link {% if 'archives' in request.resolver_match.app_names or request.path == '/' %}active{% endif %}">
                        <i class="fas fa-archive"></i> Archives
                    </a>
                    <a href="{% url 'insights:list' %}"
                        class="nav-link {% if 'insights' in request.resolver_match.app_names %}active{% endif %}">
                        <i class="fas fa-lightbulb"></i> Insights
                    </a>
                    <a href="{% url 'books:list' %}"
                        class="nav-link {% if 'books' in request.resolver_match.app_names %}active{% endif %}">
                        <i class="fas fa-book"></i> Recommended Books
                    </a>
                    <a href="{% url 'ai:home' %}"
                        class="nav-link {% if 'ai' in request.resolver_match.app_names %}active{% endif %}">
                        <i class="fas fa-robot"></i> Igbo Archives AI
                    </a>
                </div>
            </div>
        </nav>

        {% block sub_navigation %}{% endblock %}
    </div>

    <!-- Mobile Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 z-40 bg-white/95 dark:bg-surface-dark backdrop-blur-md border-t border-border dark:border-border-dark lg:hidden safe-area-pb"
        aria-label="Mobile navigation">
        <div class="flex items-center justify-around py-2">
            <a href="{% url 'archives:list' %}"
                class="flex flex-col items-center gap-0.5 py-1.5 px-4 rounded-lg transition-all {% if 'archives' in request.resolver_match.app_names or request.path == '/' %}text-accent bg-accent/10{% else %}text-text-muted hover:text-text dark:text-text-dark-muted dark:hover:text-text-dark{% endif %}">
                <i class="fas fa-archive text-base"></i>
                <span class="text-[10px] font-medium">Archives</span>
            </a>
            <a href="{% url 'insights:list' %}"
                class="flex flex-col items-center gap-0.5 py-1.5 px-4 rounded-lg transition-all {% if 'insights' in request.resolver_match.app_names %}text-accent bg-accent/10{% else %}text-text-muted hover:text-text dark:text-text-dark-muted dark:hover:text-text-dark{% endif %}">
                <i class="fas fa-lightbulb text-base"></i>
                <span class="text-[10px] font-medium">Insights</span>
            </a>
            <a href="{% url 'books:list' %}"
                class="flex flex-col items-center gap-0.5 py-1.5 px-4 rounded-lg transition-all {% if 'books' in request.resolver_match.app_names %}text-accent bg-accent/10{% else %}text-text-muted hover:text-text dark:text-text-dark-muted dark:hover:text-text-dark{% endif %}">
                <i class="fas fa-book text-base"></i>
                <span class="text-[10px] font-medium">Books</span>
            </a>
            <a href="{% url 'ai:home' %}"
                class="flex flex-col items-center gap-0.5 py-1.5 px-4 rounded-lg transition-all {% if 'ai' in request.resolver_match.app_names %}text-accent bg-accent/10{% else %}text-text-muted hover:text-text dark:text-text-dark-muted dark:hover:text-text-dark{% endif %}">
                <i class="fas fa-robot text-base"></i>
                <span class="text-[10px] font-medium">AI</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="flex-1 pb-20 lg:pb-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8">
            {% if messages %}
            <div class="space-y-3 mb-6" role="alert" aria-live="polite" id="flash-messages">
                {% for message in messages %}
                <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %}"
                    data-auto-dismiss="{% if message.tags == 'success' %}5000{% elif message.tags == 'info' %}7000{% else %}0{% endif %}">
                    <div class="flex-1">{{ message }}</div>
                    <button type="button" class="ml-auto opacity-60 hover:opacity-100 transition-opacity"
                        onclick="this.parentElement.remove()" aria-label="Dismiss">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                {% endfor %}
            </div>
            <script>
                // Auto-dismiss flash messages
                document.querySelectorAll('#flash-messages .alert[data-auto-dismiss]').forEach(function (alert) {
                    var delay = parseInt(alert.getAttribute('data-auto-dismiss'));
                    if (delay > 0) {
                        setTimeout(function () {
                            alert.style.transition = 'opacity 0.5s ease-out';
                            alert.style.opacity = '0';
                            setTimeout(function () { alert.remove(); }, 500);
                        }, delay);
                    }
                });
            </script>
            {% endif %}

            {% block content %}
            {% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer
        class="bg-white/95 dark:bg-surface-dark text-text dark:text-text-dark border-t border-border dark:border-none mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 lg:py-12 pb-24 lg:pb-12">
            <div class="grid grid-cols-3 md:grid-cols-4 gap-4 lg:gap-10">
                <!-- Brand Column -->
                <div class="col-span-full md:col-span-1">
                    <div class="mb-3">
                        <img src="{% static 'images/logos/logo-light.png' %}" alt="Igbo Archives"
                            class="h-9 w-auto logo-light">
                        <img src="{% static 'images/logos/logo-dark.png' %}" alt="Igbo Archives"
                            class="h-9 w-auto logo-dark hidden">
                    </div>
                    <p class="text-text-muted dark:text-text-dark-muted text-xs leading-relaxed mb-4">
                        Preserving and celebrating the rich history and culture of the Igbo people.
                    </p>
                    <div class="flex items-center gap-2">
                        <a href="https://www.facebook.com/IgboArchives/" target="_blank" rel="noopener noreferrer"
                            class="w-8 h-8 rounded-lg bg-accent/10 dark:bg-white/10 flex items-center justify-center text-text-muted dark:text-text-dark-muted hover:bg-accent hover:text-white transition-all text-sm"
                            aria-label="Facebook">
                            <i class="fa-brands fa-facebook-f"></i>
                        </a>
                        <a href="https://www.instagram.com/IgboArchives.com.ng/" target="_blank"
                            rel="noopener noreferrer"
                            class="w-8 h-8 rounded-lg bg-accent/10 dark:bg-white/10 flex items-center justify-center text-text-muted dark:text-text-dark-muted hover:bg-accent hover:text-white transition-all text-sm"
                            aria-label="Instagram">
                            <i class="fa-brands fa-instagram"></i>
                        </a>
                        <a href="https://x.com/IgboArchives" target="_blank" rel="noopener noreferrer"
                            class="w-8 h-8 rounded-lg bg-accent/10 dark:bg-white/10 flex items-center justify-center text-text-muted dark:text-text-dark-muted hover:bg-accent hover:text-white transition-all text-sm"
                            aria-label="X (Twitter)">
                            <i class="fa-brands fa-x-twitter"></i>
                        </a>
                        <a href="https://mastodon.social/@Igbo_Archives" target="_blank" rel="noopener noreferrer"
                            class="w-8 h-8 rounded-lg bg-accent/10 dark:bg-white/10 flex items-center justify-center text-text-muted dark:text-text-dark-muted hover:bg-accent hover:text-white transition-all text-sm"
                            aria-label="Mastodon">
                            <i class="fa-brands fa-mastodon"></i>
                        </a>
                    </div>
                </div>

                <!-- Explore Column -->
                <div>
                    <h3 class="font-medium text-xs uppercase tracking-wider text-accent mb-3">Explore</h3>
                    <div class="space-y-1.5">
                        <a href="{% url 'archives:list' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">Archives</a>
                        <a href="{% url 'insights:list' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">Insights</a>
                        <a href="{% url 'books:list' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">Books</a>
                        <a href="{% url 'ai:home' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">AI
                            Assistant</a>
                    </div>
                </div>

                <!-- Resources Column -->
                <div>
                    <h3 class="font-medium text-xs uppercase tracking-wider text-accent mb-3">Resources</h3>
                    <div class="space-y-1.5">
                        <a href="{% url 'core:about' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">About</a>
                        <a href="{% url 'core:contact' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">Contact</a>
                        <a href="{% url 'core:donate' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">Support
                            Us</a>
                    </div>
                </div>

                <!-- Legal Column -->
                <div>
                    <h3 class="font-medium text-xs uppercase tracking-wider text-accent mb-3">Legal</h3>
                    <div class="space-y-1.5">
                        <a href="{% url 'core:privacy' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">Privacy</a>
                        <a href="{% url 'core:terms' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">Terms</a>
                        <a href="{% url 'core:copyright' %}"
                            class="block text-text-muted dark:text-text-dark-muted hover:text-text dark:hover:text-text-dark transition-colors text-sm">Copyright</a>
                    </div>
                </div>
            </div>

            <div
                class="mt-8 pt-6 border-t border-border dark:border-white/10 flex flex-col sm:flex-row items-center justify-between gap-3 text-xs text-text-muted dark:text-text-dark-muted">
                <p>&copy; 2024 - {% now "Y" %} <a href="https://kiri.ng/about" target="_blank" rel="noopener noreferrer"
                        class="text-accent hover:text-text dark:hover:text-text-dark transition-colors">Kiri Research
                        Labs</a></p>
            </div>
        </div>
    </footer>

    <script src="{% static 'vendor/js/swiper-bundle.min.js' %}"></script>
    <script src="{% static 'vendor/js/htmx.min.js' %}"
        integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"
        defer></script>
    <script src="{% static 'js/common/main.js' %}" defer></script>
    <script src="{% static 'js/common/notifications.js' %}" defer></script>
    <script src="{% static 'js/common/comments.js' %}" defer></script>
    <script src="{% static 'js/common/modals.js' %}" defer></script>
    <script src="{% static 'js/common/tabs.js' %}" defer></script>
    <script src="{% static 'js/common/view-toggle.js' %}" defer></script>
    <script src="{% static 'js/common/share.js' %}" defer></script>
    <script src="{% static 'js/common/push-notifications.js' %}" id="push-notifications-script"
        data-subscribe-url="{% url 'api:push_subscribe' %}" data-unsubscribe-url="{% url 'api:push_unsubscribe' %}"
        defer></script>
    <script src="{% static 'js/common/pwa-install.js' %}" defer></script>

    {% block extra_js %}{% endblock %}

    {% if user.is_authenticated %}
    <!-- Push Notification Prompt -->
    <div id="push-notification-prompt"
        class="fixed bottom-24 lg:bottom-6 right-4 z-50 card p-3 sm:p-4 hidden animate-fade-in shadow-lg max-w-xs sm:max-w-sm">
        <div class="flex items-start gap-2 sm:gap-3 mb-3">
            <div
                class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-accent/10 flex items-center justify-center flex-shrink-0">
                <i class="fas fa-bell text-sm sm:text-base text-accent"></i>
            </div>
            <div class="flex-1 min-w-0">
                <h4 class="font-serif font-semibold text-sm sm:text-base mb-0.5">Get Notifications</h4>
                <p class="text-xs sm:text-sm text-text-muted line-clamp-2">Stay updated with instant alerts for messages
                    and post interactions.</p>
            </div>
        </div>
        <div class="flex items-center justify-end gap-2">
            <button id="push-prompt-dismiss" class="btn-secondary btn-sm text-xs px-2 py-1">Not Now</button>
            <button id="push-prompt-accept" class="btn-primary btn-sm text-xs px-2 py-1">Enable</button>
        </div>
    </div>
    {% endif %}
</body>

</html>