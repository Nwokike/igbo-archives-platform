{% load static %}
{% load pwa %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Igbo Archives - Preserving the Past, Inspiring the Future{% endblock %}</title>
    <link rel="icon" type="image/png" href="{% static 'images/logos/logo-light.png' %}">

    <a href="#main-content"
        class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-vintage-gold focus:text-white focus:px-4 focus:py-2 focus:rounded">Skip
        to main content</a>

    {% if ENABLE_ANALYTICS and GOOGLE_ANALYTICS_ID %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ GOOGLE_ANALYTICS_ID }}"></script>
    <script src="{% static 'js/analytics.js' %}" data-ga-id="{{ GOOGLE_ANALYTICS_ID }}"></script>
    {% endif %}

    {% progressive_web_app_meta %}

    {% if VAPID_PUBLIC_KEY %}
    <meta name="vapid-public-key" content="{{ VAPID_PUBLIC_KEY }}">
    {% endif %}

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="{% static 'vendor/css/google-fonts.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/css/fontawesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/tailwind.output.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}">
    <link rel="stylesheet" href="{% static 'css/modal.css' %}">

    {% block extra_css %}{% endblock %}

    <meta name="description"
        content="{% block meta_description %}Igbo Archives - A platform for Igbo cultural preservation and community engagement{% endblock %}">

    {% if ENABLE_ADSENSE %}
    <script async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client={{ GOOGLE_ADSENSE_CLIENT_ID }}"
        crossorigin="anonymous"></script>
    {% endif %}

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Igbo Archives",
      "url": "https://igboarchives.com.ng",
      "logo": "https://igboarchives.com.ng{% static 'images/logos/logo-light.png' %}",
      "sameAs": [
        "https://www.facebook.com/IgboArchives/",
        "https://www.instagram.com/IgboArchives.com.ng/",
        "https://x.com/IgboArchives",
        "https://mastodon.social/@Igbo_Archives"
      ],
      "description": "Preserving and celebrating the rich history and culture of the Igbo people."
    }
    </script>
</head>

<body
    class="font-sans antialiased bg-[#FDFCF8] text-dark-brown min-h-screen flex flex-col transition-colors duration-300">
    <button
        class="fixed bottom-24 right-4 z-40 w-12 h-12 bg-vintage-gold text-white rounded-full shadow-lg hover:bg-vintage-bronze hover:scale-110 transition-all duration-300 hidden items-center justify-center md:bottom-6"
        id="pwaInstallBtn" aria-label="Install App">
        <i class="fas fa-download text-lg"></i>
    </button>

    <div class="sticky top-0 z-50 bg-white/90 backdrop-blur-lg shadow-sm border-b border-sepia-pale/30 transition-all duration-200"
        id="stickyHeader">
        <header>
            <div
                class="max-w-7xl mx-auto flex items-center justify-between px-4 sm:px-6 lg:px-8 py-2 lg:py-2.5 gap-3 transition-all duration-200 relative">
                <!-- Left: Dark mode toggle -->
                <div class="w-20 flex justify-start">
                    <button
                        class="flex items-center justify-center w-8 h-8 rounded-lg border border-sepia-pale/60 text-dark-brown hover:bg-heritage-cream hover:border-vintage-beaver/50 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-vintage-gold/50"
                        aria-label="Toggle dark mode" id="darkModeToggle">
                        <i class="fas fa-moon text-sm"></i>
                    </button>
                </div>

                <!-- Center: Logo (absolutely positioned on desktop, flex on mobile) -->
                <a class="absolute left-1/2 -translate-x-1/2 sm:block hidden" href="{% url 'core:home' %}">
                    <img src="{% static 'images/logos/logo-dark.png' %}" alt="Igbo Archives"
                        class="h-8 lg:h-9 w-auto transition-all duration-200 logo-dark">
                    <img src="{% static 'images/logos/logo-light.png' %}" alt="Igbo Archives"
                        class="h-8 lg:h-9 w-auto transition-all duration-200 logo-light hidden">
                </a>
                <!-- Mobile logo (in flow) -->
                <a class="flex-1 flex items-center justify-center sm:hidden" href="{% url 'core:home' %}">
                    <img src="{% static 'images/logos/logo-dark.png' %}" alt="Igbo Archives"
                        class="h-8 w-auto logo-dark">
                    <img src="{% static 'images/logos/logo-light.png' %}" alt="Igbo Archives"
                        class="h-8 w-auto logo-light hidden">
                </a>

                <div class="flex items-center gap-2 sm:gap-3">
                    {% if user.is_authenticated %}
                    <div class="relative">
                        <a href="{% url 'users:notifications' %}"
                            class="flex items-center justify-center w-10 h-10 rounded-full text-dark-brown hover:bg-heritage-cream transition-colors relative focus:outline-none focus:ring-2 focus:ring-vintage-gold focus:ring-offset-2"
                            id="notificationBell" aria-label="Notifications">
                            <i class="fas fa-bell text-lg"></i>
                            {% if unread_notification_count > 0 %}
                            <span id="notificationBadge"
                                class="absolute -top-0.5 -right-0.5 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center">{{
                                unread_notification_count }}</span>
                            {% endif %}
                        </a>
                    </div>

                    <div class="relative">
                        <button
                            class="flex items-center gap-2 px-3 py-2 rounded-full border-2 border-sepia-pale hover:bg-vintage-gold hover:border-vintage-gold hover:text-white transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-vintage-gold focus:ring-offset-2"
                            id="profileButton">
                            {% if user.profile_picture %}
                            <div class="w-8 h-8 rounded-full overflow-hidden">
                                <img src="{{ user.profile_picture.url }}" alt="{{ user.get_display_name }}"
                                    class="w-full h-full object-cover">
                            </div>
                            {% else %}
                            <div
                                class="w-8 h-8 rounded-full bg-heritage-cream flex items-center justify-center text-sm font-semibold text-dark-brown">
                                {{ user.get_display_name|slice:":1"|upper }}</div>
                            {% endif %}
                            <span class="hidden sm:inline text-sm font-medium">{{ user.get_display_name }}</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>

                        <div class="absolute right-0 top-full mt-2 w-56 py-2 bg-white rounded-xl shadow-soft-lg border border-sepia-pale/50 opacity-0 invisible translate-y-2 transition-all duration-200 z-50"
                            id="profileDropdown">
                            <a href="{% url 'users:dashboard' %}"
                                class="flex items-center gap-3 px-4 py-2.5 text-sm text-dark-brown hover:bg-heritage-cream transition-colors">
                                <i class="fas fa-th-large w-4 text-center"></i> Dashboard
                            </a>
                            <a href="{% url 'users:inbox' %}"
                                class="flex items-center gap-3 px-4 py-2.5 text-sm text-dark-brown hover:bg-heritage-cream transition-colors">
                                <i class="fas fa-envelope w-4 text-center"></i> Messages
                            </a>
                            <a href="{% url 'users:notifications' %}"
                                class="flex items-center gap-3 px-4 py-2.5 text-sm text-dark-brown hover:bg-heritage-cream transition-colors">
                                <i class="fas fa-bell w-4 text-center"></i> Notifications
                            </a>
                            <a href="{% url 'users:profile_edit' user.username %}"
                                class="flex items-center gap-3 px-4 py-2.5 text-sm text-dark-brown hover:bg-heritage-cream transition-colors">
                                <i class="fas fa-edit w-4 text-center"></i> Edit Profile
                            </a>
                            <div class="my-2 border-t border-sepia-pale/50"></div>
                            <a href="{% url 'account_logout' %}"
                                class="flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors"
                                id="logoutLink">
                                <i class="fas fa-sign-out-alt w-4 text-center"></i> Logout
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <a href="{% url 'account_login' %}" class="btn-primary text-sm">
                        <i class="fas fa-sign-in-alt"></i>
                        <span class="hidden sm:inline">Login</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </header>

        <nav class="hidden lg:block border-b border-sepia-pale/30 bg-heritage-cream/30" aria-label="Main navigation">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-center gap-1 py-2">
                    <a href="{% url 'archives:list' %}"
                        class="nav-link {% if 'archives' in request.resolver_match.app_names or request.path == '/' %}active{% endif %}">
                        <i class="fas fa-archive"></i> Archives
                    </a>
                    <a href="{% url 'insights:list' %}"
                        class="nav-link {% if 'insights' in request.resolver_match.app_names %}active{% endif %}">
                        <i class="fas fa-lightbulb"></i> Insights
                    </a>
                    <a href="{% url 'books:list' %}"
                        class="nav-link {% if 'books' in request.resolver_match.app_names %}active{% endif %}">
                        <i class="fas fa-book"></i> Recommended Books
                    </a>
                    <a href="{% url 'ai:home' %}"
                        class="nav-link {% if 'ai' in request.resolver_match.app_names %}active{% endif %}">
                        <i class="fas fa-robot"></i> Igbo Archives AI
                    </a>
                </div>
            </div>
        </nav>

        {% block sub_navigation %}{% endblock %}
    </div>

    <nav class="fixed bottom-0 left-0 right-0 z-40 bg-white/90 backdrop-blur-lg border-t border-sepia-pale/30 lg:hidden safe-area-pb"
        aria-label="Mobile navigation">
        <div class="flex items-center justify-around py-1.5">
            <a href="{% url 'archives:list' %}"
                class="flex flex-col items-center gap-0.5 py-1.5 px-4 rounded-lg transition-all {% if 'archives' in request.resolver_match.app_names or request.path == '/' %}text-vintage-gold bg-vintage-gold/10{% else %}text-vintage-beaver hover:text-dark-brown{% endif %}">
                <i class="fas fa-archive text-base"></i>
                <span class="text-[10px] font-medium">Archives</span>
            </a>
            <a href="{% url 'insights:list' %}"
                class="flex flex-col items-center gap-0.5 py-1.5 px-4 rounded-lg transition-all {% if 'insights' in request.resolver_match.app_names %}text-vintage-gold bg-vintage-gold/10{% else %}text-vintage-beaver hover:text-dark-brown{% endif %}">
                <i class="fas fa-lightbulb text-base"></i>
                <span class="text-[10px] font-medium">Insights</span>
            </a>
            <a href="{% url 'books:list' %}"
                class="flex flex-col items-center gap-0.5 py-1.5 px-4 rounded-lg transition-all {% if 'books' in request.resolver_match.app_names %}text-vintage-gold bg-vintage-gold/10{% else %}text-vintage-beaver hover:text-dark-brown{% endif %}">
                <i class="fas fa-book text-base"></i>
                <span class="text-[10px] font-medium">Books</span>
            </a>
            <a href="{% url 'ai:home' %}"
                class="flex flex-col items-center gap-0.5 py-1.5 px-4 rounded-lg transition-all {% if 'ai' in request.resolver_match.app_names %}text-vintage-gold bg-vintage-gold/10{% else %}text-vintage-beaver hover:text-dark-brown{% endif %}">
                <i class="fas fa-robot text-base"></i>
                <span class="text-[10px] font-medium">AI</span>
            </a>
        </div>
    </nav>

    <main id="main-content" class="flex-1 pb-20 lg:pb-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8">
            {% if messages %}
            <div class="space-y-3 mb-6" role="alert" aria-live="polite">
                {% for message in messages %}
                <div
                    class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %} alert-dismissible animate-fade-in">
                    <div class="flex-1">{{ message }}</div>
                    <button type="button" class="alert-close" aria-label="Dismiss message">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% block content %}
            {% endblock %}
        </div>
    </main>

    <footer class="bg-dark-brown text-vintage-white mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 lg:py-12">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 lg:gap-10">
                <!-- Brand Column -->
                <div class="col-span-2 md:col-span-1">
                    <div class="mb-3">
                        <!-- Both logos for flexibility -->
                        <img src="{% static 'images/logos/logo-light.png' %}" alt="Igbo Archives"
                            class="h-9 w-auto logo-light">
                        <img src="{% static 'images/logos/logo-dark.png' %}" alt="Igbo Archives"
                            class="h-9 w-auto logo-dark hidden">
                    </div>
                    <p class="text-sepia-soft text-xs leading-relaxed mb-4">
                        Preserving and celebrating the rich history and culture of the Igbo people.
                    </p>
                    <div class="flex items-center gap-2">
                        <a href="https://www.facebook.com/IgboArchives/" target="_blank" rel="noopener noreferrer"
                            class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center text-sepia-soft hover:bg-vintage-gold hover:text-white transition-all text-sm"
                            aria-label="Facebook">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="https://www.instagram.com/IgboArchives.com.ng/" target="_blank"
                            rel="noopener noreferrer"
                            class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center text-sepia-soft hover:bg-vintage-gold hover:text-white transition-all text-sm"
                            aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://x.com/IgboArchives" target="_blank" rel="noopener noreferrer"
                            class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center text-sepia-soft hover:bg-vintage-gold hover:text-white transition-all text-sm"
                            aria-label="X (Twitter)">
                            <i class="fab fa-x-twitter"></i>
                        </a>
                        <a href="https://mastodon.social/@Igbo_Archives" target="_blank" rel="noopener noreferrer"
                            class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center text-sepia-soft hover:bg-vintage-gold hover:text-white transition-all text-sm"
                            aria-label="Mastodon">
                            <i class="fab fa-mastodon"></i>
                        </a>
                    </div>
                </div>

                <!-- Explore Column -->
                <div>
                    <h3 class="font-medium text-xs uppercase tracking-wider text-vintage-gold mb-3">Explore</h3>
                    <div class="space-y-1.5">
                        <a href="{% url 'archives:list' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">Archives</a>
                        <a href="{% url 'insights:list' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">Insights</a>
                        <a href="{% url 'books:list' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">Books</a>
                        <a href="{% url 'ai:home' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">AI Assistant</a>
                    </div>
                </div>

                <!-- Resources Column -->
                <div>
                    <h3 class="font-medium text-xs uppercase tracking-wider text-vintage-gold mb-3">Resources</h3>
                    <div class="space-y-1.5">
                        <a href="{% url 'core:about' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">About</a>
                        <a href="{% url 'core:contact' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">Contact</a>
                        <a href="{% url 'core:donate' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">Support Us</a>
                        <a href="{% url 'core:copyright' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">Copyright</a>
                    </div>
                </div>

                <!-- Legal Column -->
                <div>
                    <h3 class="font-medium text-xs uppercase tracking-wider text-vintage-gold mb-3">Legal</h3>
                    <div class="space-y-1.5">
                        <a href="{% url 'core:privacy' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">Privacy</a>
                        <a href="{% url 'core:terms' %}"
                            class="block text-sepia-soft hover:text-white transition-colors text-sm">Terms</a>
                    </div>
                </div>
            </div>

            <div
                class="mt-8 pt-6 border-t border-white/10 flex flex-col sm:flex-row items-center justify-between gap-3 text-xs text-sepia">
                <p>&copy; 2025 - {% now "Y" %} Kiri Research Labs. All Rights Reserved.</p>
                <p>A project by <a href="https://kiriresearch.com" target="_blank" rel="noopener noreferrer"
                        class="text-vintage-gold hover:text-white transition-colors">Kiri Research Labs</a></p>
            </div>
        </div>
    </footer>

    <script src="{% static 'vendor/js/htmx.min.js' %}" defer></script>
    <script src="{% static 'js/main.js' %}" defer></script>
    <script src="{% static 'js/notifications.js' %}" defer></script>
    <script src="{% static 'js/modals.js' %}" defer></script>
    <script src="{% static 'js/tabs.js' %}" defer></script>
    <script src="{% static 'js/view-toggle.js' %}" defer></script>
    <script src="{% static 'js/share.js' %}" defer></script>
    <script src="{% static 'js/push-notifications.js' %}" id="push-notifications-script"
        data-subscribe-url="{% url 'api:push_subscribe' %}" data-unsubscribe-url="{% url 'api:push_unsubscribe' %}"
        defer></script>

    {% block extra_js %}{% endblock %}

    <div id="push-notification-prompt"
        class="fixed bottom-24 lg:bottom-6 left-4 right-4 sm:left-auto sm:right-6 sm:max-w-md z-50 bg-white rounded-2xl shadow-soft-lg border border-sepia-pale/50 p-5 hidden animate-fade-in-up">
        <div class="flex items-start gap-4 mb-4">
            <div class="w-12 h-12 rounded-full bg-vintage-gold/10 flex items-center justify-center flex-shrink-0">
                <i class="fas fa-bell text-xl text-vintage-gold"></i>
            </div>
            <div>
                <h4 class="font-serif font-semibold text-dark-brown mb-1">Stay Connected in Real-Time</h4>
                <p class="text-sm text-vintage-beaver">Receive instant notifications for messages and interactions with
                    your posts. You're in control and can manage these settings anytime.</p>
            </div>
        </div>
        <div class="flex items-center justify-end gap-3">
            <button id="push-prompt-dismiss" class="btn-secondary btn-sm">Not Now</button>
            <button id="push-prompt-accept" class="btn-primary btn-sm">I Understand</button>
        </div>
    </div>
</body>

</html>