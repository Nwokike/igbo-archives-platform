{% extends 'base.html' %}
{% load static %}

{% block title %}Edit {{ archive.title }} - Igbo Archives{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h1 class="mb-4">Edit Archive</h1>
            
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="title" class="form-label">Title *</label>
                    <input type="text" class="form-control" id="title" name="title" value="{{ archive.title }}" required>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">Description *</label>
                    <textarea class="form-control" id="description" name="description" rows="6" required>{{ archive.description }}</textarea>
                    <div class="form-text">Plain text description of the archive</div>
                </div>

                <div class="mb-3">
                    <label for="archive_type" class="form-label">Archive Type *</label>
                    <select class="form-select" id="archive_type" name="archive_type" required>
                        <option value="image" {% if archive.archive_type == 'image' %}selected{% endif %}>Image</option>
                        <option value="video" {% if archive.archive_type == 'video' %}selected{% endif %}>Video</option>
                        <option value="document" {% if archive.archive_type == 'document' %}selected{% endif %}>Document</option>
                        <option value="audio" {% if archive.archive_type == 'audio' %}selected{% endif %}>Audio</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="category" class="form-label">Category</label>
                    <select class="form-select" id="category" name="category">
                        <option value="">Select category...</option>
                        {% for cat in categories %}
                        <option value="{{ cat.id }}" {% if archive.category.id == cat.id %}selected{% endif %}>{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                {% if archive.image %}
                <div class="mb-3">
                    <label class="form-label">Current Media File</label>
                    <div class="mb-2">
                        <img src="{{ archive.image.url }}" alt="{{ archive.alt_text }}" class="img-thumbnail" style="max-width: 300px;">
                    </div>
                </div>
                {% endif %}

                <div class="mb-3">
                    <label for="image" class="form-label">Media File</label>
                    <input type="file" class="form-control" id="image" name="image">
                    <div class="form-text">Leave empty to keep current file. Accepted: JPG, PNG, WEBP, MP4, PDF, etc.</div>
                </div>

                <div class="mb-3">
                    <label for="caption" class="form-label">Caption (with copyright/source info) *</label>
                    <input type="text" class="form-control" id="caption" name="caption" value="{{ archive.caption }}" required>
                    <div class="form-text">Must include copyright or source information</div>
                </div>

                <div class="mb-3">
                    <label for="alt_text" class="form-label">Image Description (Alt Text) *</label>
                    <input type="text" class="form-control" id="alt_text" name="alt_text" value="{{ archive.alt_text }}" required>
                    <div class="form-text">Describe the content for accessibility</div>
                </div>

                <div class="mb-3">
                    <label for="location" class="form-label">Location (Optional)</label>
                    <input type="text" class="form-control" id="location" name="location" value="{{ archive.location }}">
                </div>

                <div class="mb-3">
                    <label for="date_created" class="form-label">Date Created (if known)</label>
                    <input type="date" class="form-control" id="date_created" name="date_created" value="{{ archive.date_created|date:'Y-m-d' }}">
                </div>

                <div class="mb-3">
                    <label for="tags" class="form-label">Tags</label>
                    <input type="text" class="form-control" id="tags" name="tags" value="{% for tag in archive.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}" placeholder="mask, ceremony, traditional">
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">Update Archive</button>
                    <a href="{% url 'archives:detail' archive.pk %}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
