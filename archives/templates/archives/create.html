{% extends 'base.html' %}
{% load static %}

{% block title %}Upload Archive - Igbo Archives{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <h1 class="font-serif text-display-lg text-dark-brown mb-6">Upload Cultural Archive</h1>
    
    <div id="uploadError" class="alert alert-danger hidden mb-6"></div>
    
    <form method="post" enctype="multipart/form-data" id="archiveForm" class="space-y-6">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="title" class="form-label">Title *</label>
            <input type="text" class="form-input" id="title" name="title" required>
        </div>

        <div class="form-group">
            <label for="description" class="form-label">Description *</label>
            <textarea class="form-textarea" id="description" name="description" rows="5" required placeholder="Detailed description of the archive (plain text)"></textarea>
            <p class="form-help">Plain text description, no formatting</p>
        </div>

        <div class="form-group">
            <label for="archive_type" class="form-label">Archive Type *</label>
            <select class="form-select" id="archive_type" name="archive_type" required onchange="updateFileInput()">
                <option value="">Select type...</option>
                <option value="image">Image</option>
                <option value="video">Video</option>
                <option value="document">Document</option>
                <option value="audio">Audio</option>
            </select>
        </div>

        <div class="form-group">
            <label for="category" class="form-label">Category</label>
            <select class="form-select" id="category" name="category">
                <option value="">Select category...</option>
                {% for cat in categories %}
                <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div id="imageUploadSection" class="form-group hidden">
            <label for="image" class="form-label">Image File *</label>
            <input type="file" class="form-input" id="image" name="image" accept=".jpg,.jpeg,.png,.webp" onchange="validateFileSize(this, 5)">
            <p class="form-help">Accepted: JPG, JPEG, PNG, WEBP (Max 5MB)</p>
        </div>

        <div id="videoUploadSection" class="form-group hidden">
            <label for="video" class="form-label">Video File *</label>
            <input type="file" class="form-input" id="video" name="video" accept=".mp4,.webm,.ogg,.mov" onchange="validateFileSize(this, 50)">
            <p class="form-help">Accepted: MP4, WEBM, OGG, MOV (Max 50MB)</p>
        </div>

        <div id="documentUploadSection" class="form-group hidden">
            <label for="document" class="form-label">Document File *</label>
            <input type="file" class="form-input" id="document" name="document" accept=".pdf,.doc,.docx,.txt" onchange="validateFileSize(this, 10)">
            <p class="form-help">Accepted: PDF, DOC, DOCX, TXT (Max 10MB)</p>
        </div>

        <div id="audioUploadSection" class="form-group hidden">
            <label for="audio" class="form-label">Audio File *</label>
            <input type="file" class="form-input" id="audio" name="audio" accept=".mp3,.wav,.ogg,.m4a" onchange="validateFileSize(this, 10)">
            <p class="form-help">Accepted: MP3, WAV, OGG, M4A (Max 10MB)</p>
        </div>

        <div id="featuredImageSection" class="form-group hidden">
            <label for="featured_image" class="form-label">Featured Image/Thumbnail (Optional)</label>
            <input type="file" class="form-input" id="featured_image" name="featured_image" accept=".jpg,.jpeg,.png,.webp" onchange="validateFileSize(this, 5)">
            <p class="form-help">Thumbnail for videos/audio (optional, Max 5MB)</p>
        </div>

        <div class="form-group">
            <label for="caption" class="form-label">Caption (with copyright/source info) *</label>
            <input type="text" class="form-input" id="caption" name="caption" required placeholder="e.g., Photo by Northcote Thomas, 1910. Public Domain">
            <p class="form-help">Must include copyright or image source information</p>
        </div>

        <div id="altTextSection" class="form-group">
            <label for="alt_text" class="form-label">Alt Text *</label>
            <input type="text" class="form-input" id="alt_text" name="alt_text" required placeholder="Describe the image for accessibility">
            <p class="form-help">Describe the image for accessibility and SEO</p>
        </div>

        <div class="form-group">
            <label for="original_author" class="form-label">Original Author/Photographer (Optional)</label>
            <input type="text" class="form-input" id="original_author" name="original_author" placeholder="e.g., Northcote Thomas">
        </div>

        <div class="form-group">
            <label for="location" class="form-label">Location (Optional)</label>
            <input type="text" class="form-input" id="location" name="location" placeholder="e.g., Onitsha, Anambra State">
        </div>

        <div class="form-group">
            <label class="form-label">Date Created (if known)</label>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                    <label for="date_year" class="form-label text-sm">Year</label>
                    <input type="number" class="form-input" id="date_year" name="date_year" min="1800" max="2100" placeholder="e.g., 1910">
                </div>
                <div>
                    <label for="date_month" class="form-label text-sm">Month</label>
                    <select class="form-select" id="date_month" name="date_month">
                        <option value="">Unknown</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
                <div>
                    <label for="date_day" class="form-label text-sm">Day</label>
                    <input type="number" class="form-input" id="date_day" name="date_day" min="1" max="31" placeholder="Day">
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="tags" class="form-label">Tags</label>
            <input type="text" class="form-input" id="tags" name="tags" placeholder="mask, ceremony, traditional">
            <p class="form-help">Comma-separated tags for discoverability</p>
        </div>

        <div class="flex flex-col sm:flex-row gap-3 pt-4">
            <button type="submit" class="btn-primary flex-1">Upload Archive</button>
            <a href="{% url 'archives:list' %}" class="btn-secondary text-center">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updateFileInput() {
    var type = document.getElementById('archive_type').value;
    var sections = ['imageUploadSection', 'videoUploadSection', 'documentUploadSection', 'audioUploadSection', 'featuredImageSection'];
    sections.forEach(function(s) { document.getElementById(s).classList.add('hidden'); });
    
    if (type === 'image') {
        document.getElementById('imageUploadSection').classList.remove('hidden');
    } else if (type === 'video') {
        document.getElementById('videoUploadSection').classList.remove('hidden');
        document.getElementById('featuredImageSection').classList.remove('hidden');
    } else if (type === 'document') {
        document.getElementById('documentUploadSection').classList.remove('hidden');
    } else if (type === 'audio') {
        document.getElementById('audioUploadSection').classList.remove('hidden');
        document.getElementById('featuredImageSection').classList.remove('hidden');
    }
}

function validateFileSize(input, maxMB) {
    var errorDiv = document.getElementById('uploadError');
    if (input.files[0] && input.files[0].size > maxMB * 1024 * 1024) {
        errorDiv.textContent = 'File is too large. Maximum size is ' + maxMB + 'MB.';
        errorDiv.classList.remove('hidden');
        input.value = '';
    } else {
        errorDiv.classList.add('hidden');
    }
}
</script>
{% endblock %}
